#Ben Test File
import requests
import pandas as pd
from bs4 import BeautifulSoup
masterdict = {}
#COLLECTS THE STANDARD STATS OF ALL QUALIFIED BATTERS FROM FANGRAPHS
battingpages = [{'pos':'all', 'stats':'bat', 'lg':'all', 'qual':'y', 'type':'0', 'season':'2018', 'month':'0', 'team':'0', 'rost':'0',  'age':'0', 'filter' :'', 'players':'0', 'page':'1_500'}, {'pos':'all', 'stats':'bat', 'lg':'all', 'qual':'y', 'type':'1', 'season':'2018', 'month':'0', 'team':'0', 'rost':'0',  'age':'0', 'filter':'', 'players':'0', 'page':'1_500'},{'pos':'all', 'stats':'bat', 'lg':'all', 'qual':'y', 'type':'2', 'season':'2018', 'month':'0', 'team':'0', 'rost':'0',  'age':'0', 'filter':'', 'players':'0', 'page':'1_500'}, {'pos':'all', 'stats':'bat', 'lg':'all', 'qual':'y', 'type':'3', 'season':'2018', 'month':'0', 'team':'0', 'rost':'0',  'age':'0', 'filter':'', 'players':'0', 'page':'1_500'}]

def addtodict(player, year, source, stats):
    masterdict[player] = {year:{source:stats}}

def test(testplayers = ['Bryce Harper', 'Max Scherzer', 'Sean Doolittle']):
    for player in testplayers:
        print(masterdict[player][2018]['FANGRAPHS'])




kounter = 0
for x in range(len(battingpages)):
    page = requests.get("https://fangraphs.com/leaders.aspx", params=battingpages[kounter])
    soup = BeautifulSoup(page.content, 'html.parser')
    kounter+=1

    table = soup.find('div', class_="RadGrid RadGrid_FanGraphs")
    tbody = table.find('tbody')
    tablerows = tbody.find_all('tr')
    for row in tablerows:
        info = row.find_all('td')
        nameraw = info[1]
        player = nameraw.text.strip()
        stats = {};
        counter = 0
        for statname in range(len(info)):
            valueraw = info[counter]
            value = valueraw.text.strip()
            theader = table.find('thead')
            statnameslist = []
            statnames = theader.find_all('th')
            for statname in statnames:
                statname=statname.text.strip()
                statnameslist.append(statname)

            stats[statnameslist[counter]] = value
            counter+=1
            addtodict(player, 2018, 'FANGRAPHS', stats)


##This is just to test and see what stats were pulled
for stat in masterdict['Bryce Harper'][2018]['FANGRAPHS']:
    print(stat, masterdict['Bryce Harper'][2018]['FANGRAPHS'][stat])
